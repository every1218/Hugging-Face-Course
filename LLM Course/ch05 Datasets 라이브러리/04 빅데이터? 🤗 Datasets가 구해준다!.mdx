# ë¹… ë°ì´í„°? ğŸ¤— Datasetsê°€ êµ¬ì¶œí•˜ëŸ¬ ì™”ìŠµë‹ˆë‹¤! (Big data? ğŸ¤— Datasets to the rescue!)


ìš”ì¦˜ì€ íŠ¹íˆ BERTë‚˜ GPT-2ì™€ ê°™ì€ íŠ¸ëœìŠ¤í¬ë¨¸ë¥¼ ì²˜ìŒë¶€í„° ì‚¬ì „ í›ˆë ¨í•  ê³„íšì´ë¼ë©´, ìˆ˜ ê¸°ê°€ë°”ì´íŠ¸ ê·œëª¨ì˜ ë°ì´í„°ì…‹ìœ¼ë¡œ ì‘ì—…í•˜ëŠ” ìì‹ ì„ ë°œê²¬í•˜ëŠ” ê²ƒì´ ë“œë¬¸ ì¼ì´ ì•„ë‹™ë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš°, ë°ì´í„°ë¥¼ *ë¡œë“œ*í•˜ëŠ” ê²ƒì¡°ì°¨ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, GPT-2ë¥¼ ì‚¬ì „ í›ˆë ¨í•˜ëŠ” ë° ì‚¬ìš©ëœ WebText ì½”í¼ìŠ¤ëŠ” 8ë°±ë§Œ ê°œ ì´ìƒì˜ ë¬¸ì„œì™€ 40GBì˜ í…ìŠ¤íŠ¸ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ë…¸íŠ¸ë¶ì˜ RAMì— ë¡œë“œí•˜ë©´ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤!

ë‹¤í–‰íˆ ğŸ¤— DatasetsëŠ” ì´ëŸ¬í•œ í•œê³„ë¥¼ ê·¹ë³µí•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ë°ì´í„°ì…‹ì„ *ë©”ëª¨ë¦¬ ë§¤í•‘ëœ(memory-mapped)* íŒŒì¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ë©”ëª¨ë¦¬ ê´€ë¦¬ ë¬¸ì œì—ì„œ ë²—ì–´ë‚˜ê²Œ í•˜ë©°, ì½”í¼ìŠ¤ì˜ í•­ëª©ì„ *ìŠ¤íŠ¸ë¦¬ë°(streaming)*í•˜ì—¬ í•˜ë“œ ë“œë¼ì´ë¸Œ í•œê³„ì—ì„œ ë²—ì–´ë‚˜ê²Œ í•©ë‹ˆë‹¤.

<Youtube id="JwISwTCPPWo"/>

ì´ ì„¹ì…˜ì—ì„œëŠ” [Pile](https://pile.eleuther.ai)ë¡œ ì•Œë ¤ì§„ ê±°ëŒ€í•œ 825GB ì½”í¼ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ğŸ¤— Datasetsì˜ ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ íƒìƒ‰í•  ê²ƒì…ë‹ˆë‹¤. ì‹œì‘í•´ ë´…ì‹œë‹¤!

## Pileì´ë€ ë¬´ì—‡ì¸ê°€ìš”? (What is the Pile?)

Pileì€ ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸ í›ˆë ¨ì„ ìœ„í•´ [EleutherAI](https://www.eleuther.ai)ì—ì„œ ë§Œë“  ì˜ì–´ í…ìŠ¤íŠ¸ ì½”í¼ìŠ¤ì…ë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” ê³¼í•™ ê¸°ì‚¬, GitHub ì½”ë“œ ì €ì¥ì†Œ ë° í•„í„°ë§ëœ ì›¹ í…ìŠ¤íŠ¸ì— ì´ë¥´ëŠ” ë‹¤ì–‘í•œ ë°ì´í„°ì…‹ì´ í¬í•¨ë©ë‹ˆë‹¤. í›ˆë ¨ ì½”í¼ìŠ¤ëŠ” [14GB ì²­í¬](https://the-eye.eu/public/AI/pile/)ë¡œ ì œê³µë˜ë©°, [ê°œë³„ êµ¬ì„± ìš”ì†Œ](https://the-eye.eu/public/AI/pile_preliminary_components/) ì¤‘ ì¼ë¶€ë¥¼ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. [PubMed](https://pubmed.ncbi.nlm.nih.gov/)ì˜ 1,500ë§Œ ê±´ì˜ ìƒì²´ì˜í•™ ì¶œíŒë¬¼ ì´ˆë¡ ì½”í¼ìŠ¤ì¸ PubMed Abstracts ë°ì´í„°ì…‹ì„ ì‚´í´ë³´ëŠ” ê²ƒìœ¼ë¡œ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤. ì´ ë°ì´í„°ì…‹ì€ [JSON Lines í˜•ì‹](https://jsonlines.org)ì´ë©° `zstandard` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì••ì¶•ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ë¨¼ì € ë‹¤ìŒì„ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤:

```py
!pip install zstandard
```

ë‹¤ìŒìœ¼ë¡œ, [ì„¹ì…˜ 2](/course/chapter5/2)ì—ì„œ ë°°ìš´ ì›ê²© íŒŒì¼ ë¡œë”© ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ì…‹ì„ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```py
from datasets import load_dataset

# ì‹¤í–‰í•˜ëŠ” ë° ëª‡ ë¶„ì´ ê±¸ë¦¬ë¯€ë¡œ, ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ì°¨ë‚˜ ì»¤í”¼ë¥¼ ë§ˆì‹œëŸ¬ ê°€ì„¸ìš” :)
data_files = "[https://the-eye.eu/public/AI/pile_preliminary_components/PUBMED_title_abstracts_2019_baseline.jsonl.zst](https://the-eye.eu/public/AI/pile_preliminary_components/PUBMED_title_abstracts_2019_baseline.jsonl.zst)"
pubmed_dataset = load_dataset("json", data_files=data_files, split="train")
pubmed_dataset
```

```python out
Dataset({
Â  Â  features: ['meta', 'text'],
Â  Â  num_rows: 15518009
})
```

ë°ì´í„°ì…‹ì—ëŠ” 15,518,009ê°œì˜ í–‰ê³¼ 2ê°œì˜ ì—´ì´ ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë§ ë§ìŠµë‹ˆë‹¤!

<Tip>

âœ ê¸°ë³¸ì ìœ¼ë¡œ ğŸ¤— DatasetsëŠ” ë°ì´í„°ì…‹ì„ ë¡œë“œí•˜ëŠ” ë° í•„ìš”í•œ íŒŒì¼ì„ ì••ì¶• í•´ì œí•©ë‹ˆë‹¤. í•˜ë“œ ë“œë¼ì´ë¸Œ ê³µê°„ì„ ì ˆì•½í•˜ë ¤ë©´ `load_dataset()`ì˜ `download_config` ì¸ìˆ˜ì— `DownloadConfig(delete_extracted=True)`ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ë¬¸ì„œ](https://huggingface.co/docs/datasets/package_reference/builder_classes#datasets.DownloadConfig)ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

</Tip>

ì²« ë²ˆì§¸ ì˜ˆì œì˜ ë‚´ìš©ì„ ê²€ì‚¬í•´ ë´…ì‹œë‹¤:

```py
pubmed_dataset[0]
```

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
Â 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

ì¢‹ìŠµë‹ˆë‹¤. ì´ê²ƒì€ ì˜í•™ ê¸°ì‚¬ì˜ ì´ˆë¡ì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤. ì´ì œ ë°ì´í„°ì…‹ì„ ë¡œë“œí•˜ëŠ” ë° ì–¼ë§ˆë‚˜ ë§ì€ RAMì„ ì‚¬ìš©í–ˆëŠ”ì§€ ì‚´í´ë´…ì‹œë‹¤!

## ë©”ëª¨ë¦¬ ë§¤í•‘ì˜ ë§ˆë²• (The magic of memory mapping)

Pythonì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¸¡ì •í•˜ëŠ” ê°„ë‹¨í•œ ë°©ë²•ì€ `pip`ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” [`psutil`](https://psutil.readthedocs.io/en/latest/) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤:

```py
!pip install psutil
```

ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì´ í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ í™•ì¸í•  ìˆ˜ ìˆëŠ” **`Process`** í´ë˜ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤:

```py
import psutil

# Process.memory_infoëŠ” ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ í‘œí˜„ë˜ë¯€ë¡œ ë©”ê°€ë°”ì´íŠ¸ë¡œ ë³€í™˜
print(f"RAM used: {psutil.Process().memory_info().rss / (1024 * 1024):.2f} MB")
```

```python out
RAM used: 5678.33 MB
```

ì—¬ê¸°ì„œ **`rss`** ì†ì„±ì€ *ìƒì£¼ ì§‘í•© í¬ê¸°(resident set size)*ë¥¼ ë‚˜íƒ€ë‚´ë©°, í”„ë¡œì„¸ìŠ¤ê°€ RAMì—ì„œ ì°¨ì§€í•˜ëŠ” ë©”ëª¨ë¦¬ ë¶€ë¶„ì…ë‹ˆë‹¤. ì´ ì¸¡ì •ê°’ì—ëŠ” Python ì¸í„°í”„ë¦¬í„°ì™€ ìš°ë¦¬ê°€ ë¡œë“œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë©”ëª¨ë¦¬ë„ í¬í•¨ë˜ë¯€ë¡œ, ë°ì´í„°ì…‹ì„ ë¡œë“œí•˜ëŠ” ë° ì‹¤ì œë¡œ ì‚¬ìš©ëœ ë©”ëª¨ë¦¬ ì–‘ì€ ì•½ê°„ ë” ì‘ìŠµë‹ˆë‹¤. ë¹„êµë¥¼ ìœ„í•´, **`dataset_size`** ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ë””ìŠ¤í¬ì—ì„œ ë°ì´í„°ì…‹ì˜ í¬ê¸°ê°€ ì–¼ë§ˆë‚˜ ë˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ê²°ê³¼ëŠ” ì´ì „ì²˜ëŸ¼ ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ í‘œí˜„ë˜ë¯€ë¡œ, ìˆ˜ë™ìœ¼ë¡œ ê¸°ê°€ë°”ì´íŠ¸ë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤:

```py
print(f"Dataset size in bytes: {pubmed_dataset.dataset_size}")
size_gb = pubmed_dataset.dataset_size / (1024**3)
print(f"Dataset size (cache file) : {size_gb:.2f} GB")
```

```python out
Dataset size in bytes : 20979437051
Dataset size (cache file) : 19.54 GB
```

ì¢‹ìŠµë‹ˆë‹¤. ê±°ì˜ 20GBì— ë‹¬í•¨ì—ë„ ë¶ˆêµ¬í•˜ê³ , í›¨ì”¬ ì ì€ RAMìœ¼ë¡œ ë°ì´í„°ì…‹ì„ ë¡œë“œí•˜ê³  ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

<Tip>

âœï¸ **ì§ì ‘ í•´ë³´ì„¸ìš”!** [Pileì˜ í•˜ìœ„ ì§‘í•©](https://the-eye.eu/public/AI/pile_preliminary_components/) ì¤‘ ë…¸íŠ¸ë¶ì´ë‚˜ ë°ìŠ¤í¬íƒ‘ì˜ RAMë³´ë‹¤ í° ê²ƒì„ ì„ íƒí•˜ê³ , ğŸ¤— Datasetsë¡œ ë¡œë“œí•˜ê³ , ì‚¬ìš©ëœ RAM ì–‘ì„ ì¸¡ì •í•˜ì‹­ì‹œì˜¤. ì •í™•í•œ ì¸¡ì •ì„ ìœ„í•´ ìƒˆ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì´ ì‘ì—…ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ê° í•˜ìœ„ ì§‘í•©ì˜ ì••ì¶• í•´ì œëœ í¬ê¸°ëŠ” [Pile ë…¼ë¬¸](https://arxiv.org/abs/2101.00027)ì˜ í‘œ 1ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

</Tip>

Pandasì— ìµìˆ™í•˜ë‹¤ë©´, ì´ ê²°ê³¼ëŠ” Wes Kinneyì˜ ìœ ëª…í•œ *ê²½í—˜ ë²•ì¹™*(rule of thumb)ì— ë¹„ì¶”ì–´ ë³¼ ë•Œ ë†€ë„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ë°ì´í„°ì…‹ í¬ê¸°ì˜ 5~10ë°°ì˜ RAMì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ğŸ¤— DatasetsëŠ” ì´ ë©”ëª¨ë¦¬ ê´€ë¦¬ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œìš”? ğŸ¤— DatasetsëŠ” ê° ë°ì´í„°ì…‹ì„ [ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼](https://en.wikipedia.org/wiki/Memory-mapped_file)ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ëŠ” RAMê³¼ íŒŒì¼ ì‹œìŠ¤í…œ ì €ì¥ì†Œ ê°„ì˜ ë§¤í•‘ì„ ì œê³µí•˜ì—¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë°ì´í„°ì…‹ì„ ë©”ëª¨ë¦¬ì— ì™„ì „íˆ ë¡œë“œí•  í•„ìš” ì—†ì´ ì•¡ì„¸ìŠ¤í•˜ê³  ì‘ì—…í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼ì€ ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ ê°„ì— ê³µìœ ë  ìˆ˜ë„ ìˆìœ¼ë©°, ì´ëŠ” **`Dataset.map()`**ê³¼ ê°™ì€ ë©”ì„œë“œê°€ ë°ì´í„°ì…‹ì„ ì´ë™í•˜ê±°ë‚˜ ë³µì‚¬í•  í•„ìš” ì—†ì´ ë³‘ë ¬í™”ë  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ë‚´ë¶€ì ìœ¼ë¡œ ì´ëŸ¬í•œ ê¸°ëŠ¥ì€ [Apache Arrow](https://arrow.apache.org) ë©”ëª¨ë¦¬ í˜•ì‹ê³¼ [`pyarrow`](https://arrow.apache.org/docs/python/index.html) ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜í•´ ëª¨ë‘ ì‹¤í˜„ë˜ë©°, ì´ëŠ” ë°ì´í„° ë¡œë”© ë° ì²˜ë¦¬ë¥¼ ë§¤ìš° ë¹ ë¥´ê²Œ ë§Œë“­ë‹ˆë‹¤. (Apache Arrow ë° Pandasì™€ì˜ ë¹„êµì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [Dejan Simicì˜ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼](https://towardsdatascience.com/apache-arrow-read-dataframe-with-zero-memory-69634092b1a)ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤.) ì´ê²ƒì´ ì‹¤ì œë¡œ ì‘ë™í•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ê¸° ìœ„í•´, PubMed Abstracts ë°ì´í„°ì…‹ì˜ ëª¨ë“  ìš”ì†Œë¥¼ ë°˜ë³µí•˜ì—¬ ì‘ì€ ì†ë„ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ ë´…ì‹œë‹¤:

```py
import timeit

code_snippet = """batch_size = 1000

for idx in range(0, len(pubmed_dataset), batch_size):
Â  Â  _ = pubmed_dataset[idx:idx + batch_size]
"""

time = timeit.timeit(stmt=code_snippet, number=1, globals=globals())
print(
Â  Â  f"Iterated over {len(pubmed_dataset)} examples (about {size_gb:.1f} GB) in "
Â  Â  f"{time:.1f}s, i.e. {size_gb/time:.3f} GB/s"
)
```

```python out
'Iterated over 15518009 examples (about 19.5 GB) in 64.2s, i.e. 0.304 GB/s'
```

ì—¬ê¸°ì„œ Pythonì˜ `timeit` ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ **`code_snippet`**ì´ ê±¸ë¦° ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í–ˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ëª‡ ì‹­ ë¶„ì˜ 1 GB/sì—ì„œ ëª‡ GB/sì˜ ì†ë„ë¡œ ë°ì´í„°ì…‹ì„ ë°˜ë³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ëŒ€ë‹¤ìˆ˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë§¤ìš° ì í•©í•˜ì§€ë§Œ, ë•Œë¡œëŠ” ë…¸íŠ¸ë¶ì˜ í•˜ë“œ ë“œë¼ì´ë¸Œì— ì €ì¥í•˜ê¸°ì¡°ì°¨ ë„ˆë¬´ í° ë°ì´í„°ì…‹ìœ¼ë¡œ ì‘ì—…í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Pile ì „ì²´ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ë ¤ê³  í•˜ë©´ 825GBì˜ ì—¬ìœ  ë””ìŠ¤í¬ ê³µê°„ì´ í•„ìš”í•©ë‹ˆë‹¤! ì´ëŸ¬í•œ ê²½ìš°ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´, ğŸ¤— DatasetsëŠ” ë°ì´í„°ì…‹ ì „ì²´ë¥¼ ë‹¤ìš´ë¡œë“œí•  í•„ìš” ì—†ì´ ì¦‰ì‹œ ìš”ì†Œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ê²ƒì´ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

<Tip>

ğŸ’¡ Jupyter ë…¸íŠ¸ë¶ì—ì„œëŠ” [`%%timeit` ë§¤ì§ í•¨ìˆ˜](https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-timeit)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì…€ ì‹œê°„ì„ ì¸¡ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

</Tip>

## ë°ì´í„°ì…‹ ìŠ¤íŠ¸ë¦¬ë° (Streaming datasets)

ë°ì´í„°ì…‹ ìŠ¤íŠ¸ë¦¬ë°ì„ í™œì„±í™”í•˜ë ¤ë©´ **`load_dataset()`** í•¨ìˆ˜ì— **`streaming=True`** ì¸ìˆ˜ë¥¼ ì „ë‹¬í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, PubMed Abstracts ë°ì´í„°ì…‹ì„ ë‹¤ì‹œ ë¡œë“œí•˜ë˜ ìŠ¤íŠ¸ë¦¬ë° ëª¨ë“œë¡œ ë¡œë“œí•´ ë´…ì‹œë‹¤:

```py
pubmed_dataset_streamed = load_dataset(
Â  Â  "json", data_files=data_files, split="train", streaming=True
)
```

ì´ ì±•í„°ì˜ ë‹¤ë¥¸ ê³³ì—ì„œ ì ‘í•œ ì¹œìˆ™í•œ **`Dataset`** ëŒ€ì‹ , **`streaming=True`**ë¡œ ë°˜í™˜ëœ ê°ì²´ëŠ” **`IterableDataset`**ì…ë‹ˆë‹¤. ì´ë¦„ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´, **`IterableDataset`**ì˜ ìš”ì†Œì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ ì´ë¥¼ ë°˜ë³µí•´ì•¼ í•©ë‹ˆë‹¤. ìŠ¤íŠ¸ë¦¬ë°ëœ ë°ì´í„°ì…‹ì˜ ì²« ë²ˆì§¸ ìš”ì†Œì— ë‹¤ìŒê³¼ ê°™ì´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```py
next(iter(pubmed_dataset_streamed))
```

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
Â 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

ìŠ¤íŠ¸ë¦¬ë°ëœ ë°ì´í„°ì…‹ì˜ ìš”ì†ŒëŠ” **`IterableDataset.map()`**ì„ ì‚¬ìš©í•˜ì—¬ ì¦‰ì‹œ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì…ë ¥ì„ í† í°í™”í•´ì•¼ í•˜ëŠ” ê²½ìš° í›ˆë ¨ ì¤‘ì— ìœ ìš©í•©ë‹ˆë‹¤. ì´ í”„ë¡œì„¸ìŠ¤ëŠ” [ì±•í„° 3](/course/chapter3)ì—ì„œ ë°ì´í„°ì…‹ì„ í† í°í™”í•˜ëŠ” ë° ì‚¬ìš©í•œ ê²ƒê³¼ ì •í™•íˆ ë™ì¼í•˜ë©°, ìœ ì¼í•œ ì°¨ì´ì ì€ ì¶œë ¥ì´ í•˜ë‚˜ì”© ë°˜í™˜ëœë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤:

```py
from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained("distilbert-base-uncased")
tokenized_dataset = pubmed_dataset_streamed.map(lambda x: tokenizer(x["text"]))
next(iter(tokenized_dataset))
```

```python out
{'input_ids': [101, 4958, 5178, 4328, 6779, ...], 'attention_mask': [1, 1, 1, 1, 1, ...]}
```

<Tip>

ğŸ’¡ ìŠ¤íŠ¸ë¦¬ë°ì„ ì‚¬ìš©í•˜ì—¬ í† í°í™” ì†ë„ë¥¼ ë†’ì´ë ¤ë©´ ì§€ë‚œ ì„¹ì…˜ì—ì„œ ë³´ì•˜ë“¯ì´ **`batched=True`**ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì˜ˆì œë¥¼ ë°°ì¹˜ë³„ë¡œ ì²˜ë¦¬í•˜ë©°, ê¸°ë³¸ ë°°ì¹˜ í¬ê¸°ëŠ” 1,000ì´ë©° **`batch_size`** ì¸ìˆ˜ë¡œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

</Tip>

**`IterableDataset.shuffle()`**ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤íŠ¸ë¦¬ë°ëœ ë°ì´í„°ì…‹ì„ ì…”í”Œí•  ìˆ˜ë„ ìˆì§€ë§Œ, **`Dataset.shuffle()`**ê³¼ ë‹¬ë¦¬ ì´ëŠ” ë¯¸ë¦¬ ì •ì˜ëœ **`buffer_size`** ë‚´ì˜ ìš”ì†Œë§Œ ì…”í”Œí•©ë‹ˆë‹¤:

```py
shuffled_dataset = pubmed_dataset_streamed.shuffle(buffer_size=10_000, seed=42)
next(iter(shuffled_dataset))
```

```python out
{'meta': {'pmid': 11410799, 'language': 'eng'},
Â 'text': 'Randomized study of dose or schedule modification of granulocyte colony-stimulating factor in platinum-based chemotherapy for elderly patients with lung cancer ...'}
```

ì´ ì˜ˆì œì—ì„œëŠ” ë²„í¼ì˜ ì²˜ìŒ 10,000ê°œ ì˜ˆì œ ì¤‘ì—ì„œ ë¬´ì‘ìœ„ ì˜ˆì œë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤. ì˜ˆì œì— ì•¡ì„¸ìŠ¤í•˜ë©´ ë²„í¼ì˜ í•´ë‹¹ ì§€ì ì€ ì½”í¼ìŠ¤ì˜ ë‹¤ìŒ ì˜ˆì œ(ìœ„ì˜ ê²½ìš° 10,001ë²ˆì§¸ ì˜ˆì œ)ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤. **`IterableDataset.take()`** ë° **`IterableDataset.skip()`** í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤íŠ¸ë¦¬ë°ëœ ë°ì´í„°ì…‹ì—ì„œ ìš”ì†Œë¥¼ ì„ íƒí•  ìˆ˜ë„ ìˆìœ¼ë©°, ì´ëŠ” **`Dataset.select()`**ì™€ ìœ ì‚¬í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, PubMed Abstracts ë°ì´í„°ì…‹ì˜ ì²˜ìŒ 5ê°œ ì˜ˆì œë¥¼ ì„ íƒí•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```py
dataset_head = pubmed_dataset_streamed.take(5)
list(dataset_head)
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
Â  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},
Â {'meta': {'pmid': 11409575, 'language': 'eng'},
Â  'text': 'Clinical signs of hypoxaemia in children with acute lower respiratory infection: indicators of oxygen therapy ...'},
Â {'meta': {'pmid': 11409576, 'language': 'eng'},
Â  'text': "Hypoxaemia in children with severe pneumonia in Papua New Guinea ..."},
Â {'meta': {'pmid': 11409577, 'language': 'eng'},
Â  'text': 'Oxygen concentrators and cylinders ...'},
Â {'meta': {'pmid': 11409578, 'language': 'eng'},
Â  'text': 'Oxygen supply in rural africa: a personal experience ...'}]
```

ë§ˆì°¬ê°€ì§€ë¡œ, ë‹¤ìŒê³¼ ê°™ì´ **`IterableDataset.skip()`** í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì…”í”Œëœ ë°ì´í„°ì…‹ì—ì„œ í›ˆë ¨ ë° ê²€ì¦ ë¶„í• ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```py
# ì²˜ìŒ 1,000ê°œì˜ ì˜ˆì œë¥¼ ê±´ë„ˆë›°ê³  ë‚˜ë¨¸ì§€ë¥¼ í›ˆë ¨ ì„¸íŠ¸ì— í¬í•¨
train_dataset = shuffled_dataset.skip(1000)
# ê²€ì¦ ì„¸íŠ¸ë¥¼ ìœ„í•´ ì²˜ìŒ 1,000ê°œì˜ ì˜ˆì œ ê°€ì ¸ì˜¤ê¸°
validation_dataset = shuffled_dataset.take(1000)
```

ë°ì´í„°ì…‹ ìŠ¤íŠ¸ë¦¬ë° íƒìƒ‰ì„ ì¼ë°˜ì ì¸ ì‘ìš© í”„ë¡œê·¸ë¨ìœ¼ë¡œ ë§ˆë¬´ë¦¬í•´ ë´…ì‹œë‹¤. ì—¬ëŸ¬ ë°ì´í„°ì…‹ì„ ê²°í•©í•˜ì—¬ ë‹¨ì¼ ì½”í¼ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤. ğŸ¤— DatasetsëŠ” **`interleave_datasets()`** í•¨ìˆ˜ë¥¼ ì œê³µí•˜ì—¬ **`IterableDataset`** ê°ì²´ ëª©ë¡ì„ ë‹¨ì¼ **`IterableDataset`**ìœ¼ë¡œ ë³€í™˜í•˜ë©°, ì—¬ê¸°ì„œ ìƒˆ ë°ì´í„°ì…‹ì˜ ìš”ì†ŒëŠ” ì†ŒìŠ¤ ì˜ˆì œ ê°„ì— ë²ˆê°ˆì•„ ê°€ë©° ì–»ìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” íŠ¹íˆ ëŒ€ê·œëª¨ ë°ì´í„°ì…‹ì„ ê²°í•©í•˜ë ¤ê³  í•  ë•Œ ìœ ìš©í•˜ë¯€ë¡œ, ì˜ˆì œë¡œ ë¯¸êµ­ ë²•ì› ë²•ì  ì˜ê²¬ì˜ 51GB ë°ì´í„°ì…‹ì¸ Pileì˜ FreeLaw í•˜ìœ„ ì§‘í•©ì„ ìŠ¤íŠ¸ë¦¬ë°í•´ ë´…ì‹œë‹¤:

```py
law_dataset_streamed = load_dataset(
Â  Â  "json",
Â  Â  data_files="[https://the-eye.eu/public/AI/pile_preliminary_components/FreeLaw_Opinions.jsonl.zst](https://the-eye.eu/public/AI/pile_preliminary_components/FreeLaw_Opinions.jsonl.zst)",
Â  Â  split="train",
Â  Â  streaming=True,
)
next(iter(law_dataset_streamed))
```

```python out
{'meta': {'case_ID': '110921.json',
Â  'case_jurisdiction': 'scotus.tar.gz',
Â  'date_created': '2010-04-28T17:12:49Z'},
Â 'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}
```

ì´ ë°ì´í„°ì…‹ì€ ëŒ€ë¶€ë¶„ì˜ ë…¸íŠ¸ë¶ì˜ RAMì— ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì¤„ ë§Œí¼ ì¶©ë¶„íˆ í¬ì§€ë§Œ, ìš°ë¦¬ëŠ” ë•€ì„ í˜ë¦¬ì§€ ì•Šê³  ë¡œë“œí•˜ê³  ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤! ì´ì œ **`interleave_datasets()`** í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ FreeLaw ë° PubMed Abstracts ë°ì´í„°ì…‹ì˜ ì˜ˆì œë¥¼ ê²°í•©í•´ ë´…ì‹œë‹¤:

```py
from itertools import islice
from datasets import interleave_datasets

combined_dataset = interleave_datasets([pubmed_dataset_streamed, law_dataset_streamed])
list(islice(combined_dataset, 2))
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
Â  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},
Â {'meta': {'case_ID': '110921.json',
Â  Â 'case_jurisdiction': 'scotus.tar.gz',
Â  Â 'date_created': '2010-04-28T17:12:49Z'},
Â  'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}]
```

ì—¬ê¸°ì„œ Pythonì˜ `itertools` ëª¨ë“ˆì˜ **`islice()`** í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°í•©ëœ ë°ì´í„°ì…‹ì—ì„œ ì²˜ìŒ ë‘ ì˜ˆì œë¥¼ ì„ íƒí–ˆìœ¼ë©°, ë‘ ì†ŒìŠ¤ ë°ì´í„°ì…‹ì˜ ì²« ë²ˆì§¸ ì˜ˆì œì™€ ì¼ì¹˜í•¨ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ, Pile ì „ì²´(825GB)ë¥¼ ìŠ¤íŠ¸ë¦¬ë°í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¤€ë¹„ëœ ëª¨ë“  íŒŒì¼ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```py
base_url = "[https://the-eye.eu/public/AI/pile/](https://the-eye.eu/public/AI/pile/)"
data_files = {
Â  Â  "train": [base_url + "train/" + f"{idx:02d}.jsonl.zst" for idx in range(30)],
Â  Â  "validation": base_url + "val.jsonl.zst",
Â  Â  "test": base_url + "test.jsonl.zst",
}
pile_dataset = load_dataset("json", data_files=data_files, streaming=True)
next(iter(pile_dataset["train"]))
```

```python out
{'meta': {'pile_set_name': 'Pile-CC'},
Â 'text': 'It is done, and submitted. You can play â€œSurvival of the Tastiestâ€ on Android, and on the web...'}
```

<Tip>

âœï¸ **ì§ì ‘ í•´ë³´ì„¸ìš”!** [`mc4`](https://huggingface.co/datasets/mc4) ë˜ëŠ” [`oscar`](https://huggingface.co/datasets/oscar)ì™€ ê°™ì€ ëŒ€ê·œëª¨ Common Crawl ì½”í¼ìŠ¤ ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ íƒí•œ êµ­ê°€ì˜ ì–¸ì–´ ì‚¬ìš© ë¹„ìœ¨ì„ ë‚˜íƒ€ë‚´ëŠ” ìŠ¤íŠ¸ë¦¬ë° ë‹¤êµ­ì–´ ë°ì´í„°ì…‹ì„ ë§Œë“œì‹­ì‹œì˜¤. ì˜ˆë¥¼ ë“¤ì–´, ìŠ¤ìœ„ìŠ¤ì˜ 4ê°œ êµ­ì–´ëŠ” ë…ì¼ì–´, í”„ë‘ìŠ¤ì–´, ì´íƒˆë¦¬ì•„ì–´ ë° ë¡œë§ŒìŠˆì–´ì´ë¯€ë¡œ, Oscar í•˜ìœ„ ì§‘í•©ì„ ì‚¬ìš© ë¹„ìœ¨ì— ë”°ë¼ ìƒ˜í”Œë§í•˜ì—¬ ìŠ¤ìœ„ìŠ¤ ì½”í¼ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

</Tip>

ì´ì œ ëª¨ë“  ëª¨ì–‘ê³¼ í¬ê¸°ì˜ ë°ì´í„°ì…‹ì„ ë¡œë“œí•˜ê³  ì²˜ë¦¬í•˜ëŠ” ë° í•„ìš”í•œ ëª¨ë“  ë„êµ¬ë¥¼ ê°–ì¶”ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì˜ˆì™¸ì ìœ¼ë¡œ ìš´ì´ ì¢‹ì§€ ì•Šë‹¤ë©´, ë‹¹ë©´í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‹¤ì œë¡œ ë°ì´í„°ì…‹ì„ ìƒì„±í•´ì•¼ í•˜ëŠ” ì‹œì ì´ NLP ì—¬ì •ì—ì„œ ì˜¬ ê²ƒì…ë‹ˆë‹¤. ê·¸ê²ƒì´ ë‹¤ìŒ ì„¹ì…˜ì˜ ì£¼ì œì…ë‹ˆë‹¤!


<EditOnGithub source="https://github.com/huggingface/course/blob/main/chapters/en/chapter5/4.mdx" />
